<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: var(--tg-theme-text-color, #000000);
            margin-bottom: 30px;
            font-size: 24px;
            font-weight: 600;
        }

        .calendar-container {
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .nav-btn {
            background: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
        }

        .nav-btn:hover {
            opacity: 0.8;
        }

        .month-year {
            font-size: 18px;
            font-weight: 600;
            color: var(--tg-theme-text-color, #000000);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .day-header {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--tg-theme-hint-color, #999999);
            padding: 8px 0;
        }

        .day-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .day-cell:hover {
            background: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .day-cell.disabled {
            color: var(--tg-theme-hint-color, #999999);
            cursor: not-allowed;
        }

        .day-cell.disabled:hover {
            background: none;
            color: var(--tg-theme-hint-color, #999999);
        }

        .day-cell.selected {
            background: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .time-slots {
            display: none;
        }

        .time-slots.active {
            display: block;
        }

        .time-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        .time-slot {
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .time-slot:hover {
            border-color: var(--tg-theme-button-color, #3390ec);
            background: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .time-slot.selected {
            background: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
            border-color: var(--tg-theme-button-color, #3390ec);
        }

        .time-slot.disabled {
            opacity: 0.7;
            cursor: not-allowed;
            background: #ffebee;
            color: #c62828;
            position: relative;
        }

        .time-slot.disabled:hover {
            border-color: transparent;
            background: #ffebee;
            color: #c62828;
        }

        .time-slot.disabled::after {
            content: '‚ùå –ó–∞–Ω—è—Ç–æ';
            display: block;
            font-size: 11px;
            font-weight: 400;
            margin-top: 4px;
            opacity: 0.8;
        }

        .time-slot.available {
            background: #e8f5e8;
            border: 2px solid #4caf50;
            color: #2e7d32;
            position: relative;
        }

        .time-slot.available::after {
            content: '‚úÖ –°–≤–æ–±–æ–¥–Ω–æ';
            display: block;
            font-size: 11px;
            font-weight: 400;
            margin-top: 4px;
            opacity: 0.8;
        }

        .time-slot.available:hover {
            background: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
            border-color: var(--tg-theme-button-color, #3390ec);
        }

        .time-slot.available:hover::after {
            content: 'üëÜ –í—ã–±—Ä–∞—Ç—å';
        }

        .selected-info {
            background: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            margin-top: 20px;
            font-weight: 600;
            display: none;
        }

        .selected-info.active {
            display: block;
        }

        .loading {
            text-align: center;
            color: var(--tg-theme-hint-color, #999999);
            margin: 20px 0;
        }

        @media (max-width: 480px) {
            .time-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è</h1>
        
        <div class="calendar-container">
            <div class="calendar-header">
                <button class="nav-btn" id="prevMonth">‚Äπ</button>
                <div class="month-year" id="monthYear"></div>
                <button class="nav-btn" id="nextMonth">‚Ä∫</button>
            </div>
            
            <div class="calendar-grid" id="calendar">
                <!-- Calendar will be generated here -->
            </div>
        </div>

        <div class="time-slots" id="timeSlots">
            <h3 style="margin-bottom: 16px; color: var(--tg-theme-text-color, #000000);">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è:</h3>
            <div class="time-grid" id="timeGrid">
                <!-- Time slots will be generated here -->
            </div>
        </div>

        <div class="selected-info" id="selectedInfo">
            <div id="selectedDateTime"></div>
        </div>

        <div class="loading" id="loading" style="display: none;">
            –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å...
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
        const tg = window.Telegram?.WebApp || {
            // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ
            expand: () => console.log('tg.expand() called'),
            ready: () => console.log('tg.ready() called'),
            MainButton: {
                setText: (text) => console.log('MainButton text:', text),
                show: () => console.log('MainButton shown'),
                hide: () => console.log('MainButton hidden'),
                onClick: (callback) => {
                    console.log('MainButton onClick set');
                    // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É
                    if (!document.getElementById('testButton')) {
                        const btn = document.createElement('button');
                        btn.id = 'testButton';
                        btn.textContent = '–ó–∞–ø–∏—Å–∞—Ç—å—Å—è (–¢–ï–°–¢)';
                        btn.style.cssText = `
                            position: fixed;
                            bottom: 20px;
                            left: 50%;
                            transform: translateX(-50%);
                            background: var(--tg-theme-button-color, #3390ec);
                            color: white;
                            border: none;
                            padding: 16px 32px;
                            border-radius: 12px;
                            font-size: 16px;
                            font-weight: 600;
                            cursor: pointer;
                            z-index: 1000;
                        `;
                        btn.onclick = callback;
                        document.body.appendChild(btn);
                    }
                }
            },
            sendData: (data) => {
                console.log('Sending data to Telegram:', data);
                alert('–î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram:\n\n' + data);
            },
            close: () => console.log('tg.close() called'),
            colorScheme: 'light',
            initDataUnsafe: {
                user: {
                    id: 12345,
                    first_name: 'Test',
                    username: 'testuser'
                }
            }
        };
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ä–∞–±–æ—Ç–∞–µ–º –ª–∏ –º—ã –≤ Telegram
        const isInTelegram = window.Telegram && window.Telegram.WebApp;
        if (isInTelegram) {
            tg.expand();
            tg.ready();
        } else {
            console.log('üß™ –†–µ–∂–∏–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ');
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
            const testNotice = document.createElement('div');
            testNotice.style.cssText = `
                position: fixed;
                top: 10px;
                left: 50%;
                transform: translateX(-50%);
                background: #ff9500;
                color: white;
                padding: 8px 16px;
                border-radius: 8px;
                font-size: 12px;
                z-index: 1000;
            `;
            testNotice.textContent = 'üß™ –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (–æ—Ç–∫—Ä–æ–π—Ç–µ –≤ Telegram –¥–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏)';
            document.body.appendChild(testNotice);
        }

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ –∫–∞–∂–¥—ã–π –ø—Ä–æ–µ–∫—Ç)
        const CONFIG = {
            // –†–∞–±–æ—á–∏–µ —á–∞—Å—ã (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å)
            workingHours: [14, 15, 19],
            
            // –†–∞–±–æ—á–∏–µ –¥–Ω–∏ (0 = –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 1 = –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, ...)
            workingDays: [1, 2, 3, 4, 5], // –ø–Ω-–ø—Ç
            
            // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ –∑–∞—Ä–∞–Ω–µ–µ –¥–ª—è –∑–∞–ø–∏—Å–∏
            minHoursAhead: 2,
            
            // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤–ø–µ—Ä–µ–¥ –¥–ª—è –∑–∞–ø–∏—Å–∏
            maxDaysAhead: 21,
            
            // URL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–Ω—è—Ç—ã—Ö —Å–ª–æ—Ç–æ–≤ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
            checkAvailabilityUrl: null, // –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ Make.com webhook
            
            // –ó–∞–Ω—è—Ç—ã–µ —Å–ª–æ—Ç—ã (–¥–ª—è –¥–µ–º–æ, –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞)
            blockedSlots: [
                '2025-05-29-14',
                '2025-05-30-15',
                '2025-05-31-19',
                '2025-06-01-16'
            ],

            // URL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–Ω—è—Ç—ã—Ö —Å–ª–æ—Ç–æ–≤ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Make.com)
            getBookedSlotsUrl: 'https://hook.make.com/your-webhook-url', // –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à
        };

        let currentDate = new Date();
        let selectedDate = null;
        let selectedTime = null;

        const months = [
            '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
            '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
        ];

        const dayHeaders = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];

        function initCalendar() {
            renderCalendar();
            
            document.getElementById('prevMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });
            
            document.getElementById('nextMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            const monthYear = document.getElementById('monthYear');
            
            monthYear.textContent = `${months[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            
            calendar.innerHTML = '';
            
            // –ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
            dayHeaders.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'day-header';
                dayHeader.textContent = day;
                calendar.appendChild(dayHeader);
            });
            
            // –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            
            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –Ω–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏ (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ = 0)
            const dayOfWeek = (firstDay.getDay() + 6) % 7;
            startDate.setDate(startDate.getDate() - dayOfWeek);
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å (6 –Ω–µ–¥–µ–ª—å)
            for (let i = 0; i < 42; i++) {
                const cellDate = new Date(startDate);
                cellDate.setDate(startDate.getDate() + i);
                
                const dayCell = document.createElement('div');
                dayCell.className = 'day-cell';
                dayCell.textContent = cellDate.getDate();
                
                const isCurrentMonth = cellDate.getMonth() === currentDate.getMonth();
                const isAvailable = isDateAvailable(cellDate);
                
                if (!isCurrentMonth || !isAvailable) {
                    dayCell.classList.add('disabled');
                } else {
                    dayCell.addEventListener('click', () => selectDate(cellDate));
                }
                
                calendar.appendChild(dayCell);
            }
        }

        function isDateAvailable(date) {
            const now = new Date();
            const minDate = new Date(now.getTime() + CONFIG.minHoursAhead * 60 * 60 * 1000);
            const maxDate = new Date(now.getTime() + CONFIG.maxDaysAhead * 24 * 60 * 60 * 1000);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç
            if (date < minDate || date > maxDate) return false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏
            const dayOfWeek = date.getDay();
            if (!CONFIG.workingDays.includes(dayOfWeek)) return false;
            
            return true;
        }

        function selectDate(date) {
            selectedDate = new Date(date);
            selectedTime = null;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
            document.querySelectorAll('.day-cell').forEach(cell => {
                cell.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–æ—Ç—ã –≤—Ä–µ–º–µ–Ω–∏
            renderTimeSlots();
        }

        function renderTimeSlots() {
            const timeSlots = document.getElementById('timeSlots');
            const timeGrid = document.getElementById('timeGrid');
            const loading = document.getElementById('loading');
            
            timeSlots.classList.add('active');
            timeGrid.innerHTML = '';
            loading.style.display = 'block';
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å URL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–Ω—è—Ç—ã—Ö —Å–ª–æ—Ç–æ–≤, –∑–∞–≥—Ä—É–∂–∞–µ–º –∏—Ö
            if (CONFIG.getBookedSlotsUrl) {
                loadBookedSlots(selectedDate).then(() => {
                    renderTimeSlotsUI();
                    loading.style.display = 'none';
                });
            } else {
                renderTimeSlotsUI();
                loading.style.display = 'none';
            }
        }

        async function loadBookedSlots(date) {
            try {
                const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                
                const response = await fetch(CONFIG.getBookedSlotsUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        date: dateStr,
                        action: 'getBookedSlots'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    // –û–±–Ω–æ–≤–ª—è–µ–º blocked slots –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã
                    CONFIG.blockedSlots = CONFIG.blockedSlots.filter(slot => !slot.startsWith(dateStr));
                    if (data.bookedSlots) {
                        CONFIG.blockedSlots.push(...data.bookedSlots);
                    }
                }
            } catch (error) {
                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–Ω—è—Ç—ã–µ —Å–ª–æ—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
            }
        }

        function renderTimeSlotsUI() {
            const timeGrid = document.getElementById('timeGrid');
            timeGrid.innerHTML = '';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
            const dateStr = selectedDate.toLocaleDateString('ru-RU', { 
                weekday: 'long', 
                day: 'numeric', 
                month: 'long' 
            });
            
            const infoDiv = document.createElement('div');
            infoDiv.style.cssText = `
                grid-column: 1 / -1;
                text-align: center;
                padding: 12px;
                background: var(--tg-theme-secondary-bg-color, #f5f5f5);
                border-radius: 8px;
                margin-bottom: 12px;
                font-weight: 600;
                color: var(--tg-theme-text-color, #000000);
            `;
            infoDiv.innerHTML = `üìÖ ${dateStr}<br><small style="opacity: 0.7;">–í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è</small>`;
            timeGrid.appendChild(infoDiv);

            CONFIG.workingHours.forEach(hour => {
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';
                
                // –°–æ–∑–¥–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–ª–æ—Ç–∞
                const timeDiv = document.createElement('div');
                timeDiv.style.fontWeight = '600';
                timeDiv.textContent = `${hour}:00`;
                timeSlot.appendChild(timeDiv);
                
                const slotKey = `${selectedDate.getFullYear()}-${String(selectedDate.getMonth() + 1).padStart(2, '0')}-${String(selectedDate.getDate()).padStart(2, '0')}-${hour}`;
                
                if (CONFIG.blockedSlots.includes(slotKey)) {
                    timeSlot.classList.add('disabled');
                } else {
                    timeSlot.classList.add('available');
                    timeSlot.addEventListener('click', () => selectTime(hour, timeSlot));
                }
                
                timeGrid.appendChild(timeSlot);
            });

            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            const availableCount = CONFIG.workingHours.filter(hour => {
                const slotKey = `${selectedDate.getFullYear()}-${String(selectedDate.getMonth() + 1).padStart(2, '0')}-${String(selectedDate.getDate()).padStart(2, '0')}-${hour}`;
                return !CONFIG.blockedSlots.includes(slotKey);
            }).length;

            const statsDiv = document.createElement('div');
            statsDiv.style.cssText = `
                grid-column: 1 / -1;
                text-align: center;
                padding: 8px;
                font-size: 12px;
                color: var(--tg-theme-hint-color, #999999);
                margin-top: 8px;
            `;
            statsDiv.innerHTML = `
                ‚úÖ –°–≤–æ–±–æ–¥–Ω–æ: <strong>${availableCount}</strong> –∏–∑ ${CONFIG.workingHours.length} —Å–ª–æ—Ç–æ–≤
            `;
            timeGrid.appendChild(statsDiv);
        }

        function selectTime(hour, element) {
            selectedTime = hour;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ —Å–ª–æ—Ç–æ–≤ –≤—Ä–µ–º–µ–Ω–∏
            document.querySelectorAll('.time-slot.available').forEach(slot => {
                slot.classList.remove('selected');
            });
            element.classList.add('selected');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            showSelectedInfo();
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
            const dateStr = selectedDate.toLocaleDateString('ru-RU');
            const timeStr = `${hour}:00`;
            
            tg.MainButton.setText(`‚úÖ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ ${dateStr} –≤ ${timeStr}`);
            tg.MainButton.show();
            tg.MainButton.onClick(() => {
                sendData();
            });
        }

        function showSelectedInfo() {
            const selectedInfo = document.getElementById('selectedInfo');
            const selectedDateTime = document.getElementById('selectedDateTime');
            
            const dateStr = selectedDate.toLocaleDateString('ru-RU', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            selectedDateTime.innerHTML = `
                <div>üìÖ ${dateStr}</div>
                <div style="margin-top: 8px;">‚è∞ ${selectedTime}:00</div>
            `;
            
            selectedInfo.classList.add('active');
        }

        function sendData() {
            const data = {
                date: selectedDate.toISOString().split('T')[0],
                time: selectedTime,
                timestamp: Math.floor(selectedDate.getTime() / 1000),
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                user: tg.initDataUnsafe?.user || null
            };
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞—Ç–Ω–æ –≤ –±–æ—Ç
            tg.sendData(JSON.stringify(data));
            tg.close();
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        initCalendar();

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã
        document.documentElement.style.setProperty('--tg-color-scheme', tg.colorScheme || 'light');
    </script>
</body>
</html>
  
